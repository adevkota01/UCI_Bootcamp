
Sub stock_prices()

Dim ws As Worksheet

Dim stockSymbol As String
Dim begPrice As Double
Dim endPrice As Double
Dim totalVolume As Double

totalVolume = 0



For Each ws In ThisWorkbook.Worksheets

ws.Activate

On Error Resume Next

Dim Summary_Table_Row As Integer
  Summary_Table_Row = 2
  
  Columns("J:U").Select
    Selection.Delete Shift:=xlToLeft
  
  lastrow = Cells(Rows.Count, "A").End(xlUp).Row - 1


For i = 1 To lastrow
    
    If Cells(i, 1) <> Cells(i + 1, 1) Then
        stockSymbol = Cells(i + 1, 1).Value
        begPrice = Cells(i + 1, 3).Value
        
        
   
 Range("o" & Summary_Table_Row).Value = stockSymbol

     
      Range("p" & Summary_Table_Row).Value = begPrice
      
     
     Summary_Table_Row = Summary_Table_Row + 1
'        MsgBox (stockSymbol)
'        MsgBox (begPrice)

    
 End If
    
     
     Next i
     
     Summary_Table_Row = 2
lastrow = Cells(Rows.Count, "A").End(xlUp).Row + 1

     
     For i = 2 To lastrow
    
    If Cells(i, 1) <> Cells(i + 1, 1) Then
        
       endPrice = Cells(i, 6).Value
      
      
      
      
        
      
   
 Range("q" & Summary_Table_Row).Value = endPrice


     
     Summary_Table_Row = Summary_Table_Row + 1
'        MsgBox (stockSymbol)
'        MsgBox (begPrice)



    

 
    End If
    
     
     Next i
     
     lastrow = Cells(Rows.Count, "o").End(xlUp).Row

     
     For i = 2 To lastrow
     
     Cells(i, 18) = Cells(i, 17) - Cells(i, 16)
     Cells(i, 18).NumberFormat = "0.00"
     
     
     Cells(i, 19) = (Cells(i, 18) / Cells(i, 16))
     
      
       
     Next i
     
     Summary_Table_Row = 2
lastrow = Cells(Rows.Count, "A").End(xlUp).Row
totalVolume = 0
     
     For i = 2 To lastrow
   
   If Cells(i + 1, 1).Value <> Cells(i, 1).Value Then
   totalVolume = totalVolume + Cells(i, 7).Value
        
      
   
 Range("t" & Summary_Table_Row).Value = totalVolume


     
     Summary_Table_Row = Summary_Table_Row + 1
     
     totalVolume = 0
Else
  totalVolume = totalVolume + Cells(i, 7).Value
        
    End If
    
    
    
    Next i
    
    
    Range("s2").Select
 Range(Selection, Selection.End(xlDown)).Select
    Selection.NumberFormat = "0.00%"
    
    Range("R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    
    Selection.FormatConditions.AddColorScale ColorScaleType:=2
    Selection.FormatConditions(Selection.FormatConditions.Count).SetFirstPriority
    Selection.FormatConditions(1).ColorScaleCriteria(1).Type = _
        xlConditionValueNumber
    Selection.FormatConditions(1).ColorScaleCriteria(1).Value = 0
    With Selection.FormatConditions(1).ColorScaleCriteria(1).FormatColor
        .Color = 255
        .TintAndShade = 0
    End With
    Selection.FormatConditions(1).ColorScaleCriteria(2).Type = _
        xlConditionValueNumber
    Selection.FormatConditions(1).ColorScaleCriteria(2).Value = 0
    With Selection.FormatConditions(1).ColorScaleCriteria(2).FormatColor
        .Color = 5287936
        .TintAndShade = 0
    End With
    
    Columns("P:Q").Select
    Selection.Delete Shift:=xlToLeft
    
    Range("o1").Value = "Ticker"
    Range("p1").Value = "Yearly Change"
    Range("q1").Value = "Percentage Change"
    Range("r1").Value = "Volume"
    Columns("o:r").AutoFit
    
    Range("R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.NumberFormat = 0
   
    

  Dim Max As Double
  Dim Min As Double
  Dim MaxVol As Double
  
  
  
  
  lastrow = Range("Q" & Rows.Count).End(xlUp).Row

    Set rngPctChng = Range("Q2:Q" & lastrow)
    
     'calculations
      Max = Application.Max(rngPctChng)
    Min = Application.Min(rngPctChng)
     
     
       Cells(3, 22).Value = Max
       Cells(3, 22).Select
    Selection.NumberFormat = "0.00%"
    
    Cells(4, 22).Value = Min
       Cells(4, 22).Select
    Selection.NumberFormat = "0.00%"
     
     Set rngVol = Range("r2:r" & lastrow)
    
     'calculations
      MaxVol = Application.Max(rngVol)
   
       
    Cells(5, 22).Value = MaxVol
    
    
    
    Range("W3").Select
    ActiveCell.FormulaR1C1 = _
        "=INDEX(R[-1]C[-8]:R[15870]C[-8],MATCH(RC[-1],R[-1]C[-6]:R[15870]C[-6],0))"
    Range("W4").Select
    ActiveCell.FormulaR1C1 = _
        "=INDEX(R[-2]C[-8]:R[15870]C[-8],MATCH(RC[-1],R[-2]C[-6]:R[15870]C[-6],0))"
    Range("W5").Select
    ActiveCell.FormulaR1C1 = _
        "=INDEX(R[-3]C[-8]:R[15870]C[-8],MATCH(RC[-1],R[-3]C[-5]:R[15870]C[-5],0))"
        
         Range("V3:W5").Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Application.CutCopyMode = False
  
    
    Range("u3").Value = "Greatest % Increase"
    Range("u4").Value = "Greatest % Decrease"
    Range("u5").Value = "Greatest Total Volume"
    Range("v2").Value = "Value"
    Range("w2").Value = "Ticker"
    Columns("u:w").AutoFit
    
     Columns("J:N").Select
    Selection.Delete Shift:=xlToLeft
    
     Next
    
End Sub




